<!DOCTYPE html>
<html>
<head>
    <title>ì…ê³  ë“±ë¡</title>
</head>
<body>
    <h2>ì…ê³  ë“±ë¡</h2>

    <form method="post">
        <label>SKU ë˜ëŠ” ë°”ì½”ë“œ ì…ë ¥:</label><br>
        <input type="text" id="identifier_input" name="identifier"><br><br>

        <label>ê²€ìƒ‰ ê²°ê³¼:</label><br>
        <select id="product_select">
            <option value="">ê²€ìƒ‰ í›„ ì„ íƒ</option><br><br>
        </select><br><br>

        <label>ì œí’ˆëª…:</label><br>
        <input type="text" id="product_name" readonly><br><br>

        <label>ì˜ë¬¸ëª…:</label><br>
        <input type="text" id="english_name" readonly><br><br>

        <!-- ì…ìˆ˜ëŸ‰ -->
        <label>ë°•ìŠ¤ë‹¹ ì…ìˆ˜ëŸ‰ (í•„ìˆ˜):</label><br>
        <input type="number" name="unit_per_box" value="1" min="1" required><br><br>

        <!-- ë°•ìŠ¤ìˆ˜ëŸ‰ -->
        <label>ë°•ìŠ¤ ìˆ˜ëŸ‰:</label><br>
        <input type="number" name="box_qty" value="0"><br><br>

        <!-- ë‚±ê°œìˆ˜ëŸ‰ -->
        <label>ë‚±ê°œ ìˆ˜ëŸ‰:</label><br>
        <input type="number" name="piece_qty" value="0"><br><br>

        <!-- ì°½ê³  ì„ íƒ -->
        <label>ì°½ê³  ìœ„ì¹˜:</label><br>
        <select name="warehouse" required>
            <option value="ì‹ ì°½ê³ ">ì‹ ì°½ê³ </option>
            <option value="ë§¤ì¥ì°½ê³ ">ë§¤ì¥ì°½ê³ </option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select><br><br>

        <!-- ì„ ë°˜ ìœ„ì¹˜ -->
        <label>ì„ ë°˜ ìœ„ì¹˜ (ì„ íƒ):</label><br>
        <input type="text" name="shelf_location"><br><br>

        <!-- ì…ê³  ë°œì£¼ë²ˆí˜¸ -->
        <label>ì…ê³  ë°œì£¼ë²ˆí˜¸ (ì„ íƒ):</label><br>
        <input type="text" name="order_number"><br><br>

        <!-- ìœ í†µê¸°í•œ -->
        <label>ìœ í†µê¸°í•œ (ì„ íƒ):</label><br>
        <input type="date" name="expiration_date"><br><br>

        <button type="submit">ì…ê³  ë“±ë¡</button>
    </form>

    <!-- ğŸ”½ ì œí’ˆëª… ìë™ í‘œì‹œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
    document.getElementById("identifier_input").addEventListener("blur", function () {
        const identifier = this.value.trim();
        if (!identifier) return;

        fetch(`/api/product_info?identifier=${encodeURIComponent(identifier)}`)
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("product_select");
                select.innerHTML = '<option value="">ê²€ìƒ‰ í›„ ì„ íƒ</option>';  // ì´ˆê¸°í™”

                if (data.results.length === 0) {
                    alert("ì¼ì¹˜í•˜ëŠ” ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                // ê²°ê³¼ë¥¼ selectì— ì¶”ê°€
                data.results.forEach(product => {
                    const option = document.createElement("option");
                    option.value = JSON.stringify(product);  // ì „ì²´ ê°ì²´ ì €ì¥
                    option.text = `${product.sku} - ${product.name} (${product.english_name})`;
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error("ê²€ìƒ‰ ì˜¤ë¥˜:", error);
            });
    });

    document.getElementById("product_select").addEventListener("change", function () {
        const selected = this.value;
        if (!selected) return;

        const product = JSON.parse(selected);
        document.getElementById("product_name").value = product.name;
        document.getElementById("english_name").value = product.english_name;
    });
    </script>

</body>
</html>
